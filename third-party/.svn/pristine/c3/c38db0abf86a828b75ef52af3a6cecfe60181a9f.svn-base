<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009"
        xmlns:s="library://ns.adobe.com/flex/spark"
        initialize="view1_initializeHandler(event)">

    <fx:Script>
        <![CDATA[
            import com.esri.ags.Map;

            import mx.events.FlexEvent;

            import spark.managers.PersistenceManager;
            import spark.transitions.SlideViewTransition;
            import spark.transitions.ViewTransitionDirection;

            private var persistenceManager:PersistenceManager = new PersistenceManager;
            private var map:Map;
            private var previousView:View;

            protected function view1_initializeHandler(event:FlexEvent):void
            {
                previousView = data.view;
                map = persistenceManager.getProperty("map") as Map;
                if (!map)
                {
                    map = data.map as Map;
                    persistenceManager.setProperty("map", map);
                }
                title = data.title;
                addElementAt(map, 0);
            }

            protected function backButton_clickHandler(event:MouseEvent):void
            {
                persistenceManager.setProperty("map", null);

                var transition:SlideViewTransition = new SlideViewTransition;
                transition.direction = ViewTransitionDirection.RIGHT;
                if (previousView is SearchView)
                {
                    navigator.pushView(SearchView, null, null, transition);
                }
                else
                {
                    navigator.pushView(WebMapsView, null, null, transition);
                }
            }
        ]]>
    </fx:Script>

    <s:navigationContent>
        <s:Button id="backButton"
                  click="backButton_clickHandler(event)"
                  icon="@Embed('assets/back.png')"/>
    </s:navigationContent>
</s:View>
